#!/bin/bash

: ${PORT:="3000"}

npm run clean
npm run copy-assets

spritesmith

stylus client/css/all.styl \
  --include-css \
  --include client/css \
  --print | cleancss --s0 > .bin/public/css/all.css

browserify client/js/main.js \
  --plugin bundle-collapser/plugin \
    | uglifyjs \
      --mangle \
      --compress "comparisons=false,keep_fargs=true,unsafe=true,unsafe_comps=true,warnings=false" \
      --beautify "ascii_only=true,beautify=false" \
      --output .bin/public/js/all.js
